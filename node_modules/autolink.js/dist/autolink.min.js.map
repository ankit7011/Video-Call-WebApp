{"version":3,"file":"autolink.min.js","sources":["../src/index.js"],"sourcesContent":["const re = {\n  http: /.*?:\\/\\//g,\n  url: /(\\s|^)((https?|ftp):\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([\\w-\\/\\?\\=\\#\\.])*/gi,\n  image: /\\.(jpe?g|png|gif)$/,\n  email: /(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/gi,\n  cloudmusic: /http:\\/\\/music\\.163\\.com\\/#\\/song\\?id=(\\d+)/i,\n  kickstarter: /(https?:\\/\\/www\\.kickstarter\\.com\\/projects\\/\\d+\\/[a-zA-Z0-9_-]+)(\\?\\w+\\=\\w+)?/i,\n  youtube: /https?:\\/\\/www\\.youtube\\.com\\/watch\\?v=([a-zA-Z0-9_-]+)(\\?\\w+\\=\\w+)?/i,\n  vimeo: /https?:\\/\\/(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/[^\\/]*\\/videos\\/|album\\/\\d+\\/video\\/|video\\/|)(\\d+)(?:$|\\/|\\?)/i,\n  youku: /https?:\\/\\/v\\.youku\\.com\\/v_show\\/id_([a-zA-Z0-9_\\=-]+).html(\\?\\w+\\=\\w+)?(\\#\\w+)?/i\n}\n/**\n * AutoLink constructor function\n *\n * @param {String} text\n * @param {Object} options\n * @constructor\n */\nfunction AutoLink(string, options = {}) {\n  this.string = options.safe ? safe_tags_replace(string) : string\n  this.options = options\n  this.attrs = ''\n  this.linkAttr = ''\n  this.imageAttr = ''\n  if (this.options.sharedAttr) {\n    this.attrs = getAttr(this.options.sharedAttr)\n  }\n  if (this.options.linkAttr) {\n    this.linkAttr = getAttr(this.options.linkAttr)\n  }\n  if (this.options.imageAttr) {\n    this.imageAttr = getAttr(this.options.imageAttr)\n  }\n}\n\nAutoLink.prototype = {\n  constructor: AutoLink,\n  /**\n   * call relative functions to parse url/email/image\n   *\n   * @returns {String}\n   */\n  parse: function() {\n    var shouldReplaceImage = defaultTrue(this.options.image)\n    var shouldRelaceEmail = defaultTrue(this.options.email)\n    var shouldRelaceBr = defaultTrue(this.options.br)\n\n    var result = ''\n    if (!shouldReplaceImage) {\n      result = this.string.replace(re.url, this.formatURLMatch.bind(this))\n    } else {\n      result = this.string.replace(re.url, this.formatIMGMatch.bind(this))\n    }\n    if (shouldRelaceEmail) {\n      result = this.formatEmailMatch.call(this, result)\n    }\n    if (shouldRelaceBr) {\n      result = result.replace(/\\r?\\n/g, '<br />')\n    }\n    return result\n  },\n  /**\n   * @param {String} match\n   * @returns {String} Offset 1\n   */\n  formatURLMatch: function(match, p1) {\n    match = prepHTTP(match.trim())\n    if (this.options.cloudmusic || this.options.embed) {\n      if (match.indexOf('music.163.com/#/song?id=') > -1) {\n        return match.replace(\n          re.cloudmusic,\n          p1 +\n            '<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"http://music.163.com/outchain/player?type=2&id=$1&auto=1&height=66\"></iframe>'\n        )\n      }\n    }\n    if (this.options.kickstarter || this.options.embed) {\n      if (re.kickstarter.test(match)) {\n        return match.replace(\n          re.kickstarter,\n          p1 +\n            '<iframe width=\"480\" height=\"360\" src=\"$1/widget/video.html\" frameborder=\"0\" scrolling=\"no\"> </iframe>'\n        )\n      }\n    }\n    if (this.options.vimeo || this.options.embed) {\n      if (re.vimeo.test(match)) {\n        return match.replace(\n          re.vimeo,\n          p1 +\n            '<iframe width=\"500\" height=\"281\" src=\"https://player.vimeo.com/video/$1\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'\n        )\n      }\n    }\n    if (this.options.youtube || this.options.embed) {\n      if (re.youtube.test(match)) {\n        return match.replace(\n          re.youtube,\n          p1 +\n            '<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/$1\" frameborder=\"0\" allowfullscreen></iframe>'\n        )\n      }\n    }\n    if (this.options.youku || this.options.embed) {\n      if (re.youku.test(match)) {\n        return match.replace(\n          re.youku,\n          p1 +\n            '<iframe height=498 width=510 src=\"http://player.youku.com/embed/$1\" frameborder=0 allowfullscreen></iframe>'\n        )\n      }\n    }\n    var text = this.options.removeHTTP ? removeHTTP(match) : match\n    return (\n      p1 +\n      '<a href=\"' +\n      match +\n      '\"' +\n      this.attrs +\n      this.linkAttr +\n      '>' +\n      text +\n      '</a>'\n    )\n  },\n  /**\n   * @param {String} match\n   * @param {String} Offset 1\n   */\n  formatIMGMatch: function(match, p1) {\n    match = match.trim()\n    var isIMG = re.image.test(match)\n    if (isIMG) {\n      return (\n        p1 +\n        '<img src=\"' +\n        prepHTTP(match.trim()) +\n        '\"' +\n        this.attrs +\n        this.imageAttr +\n        '/>'\n      )\n    }\n    return this.formatURLMatch(match, p1)\n  },\n  /**\n   * @param {String} text\n   */\n  formatEmailMatch: function(text) {\n    return text.replace(\n      re.email,\n      '<a href=\"mailto:$&\"' + this.attrs + this.linkAttr + '>$&</a>'\n    )\n  }\n}\n\n/**\n * return true if undefined\n * else return itself\n *\n * @param {Boolean} val\n * @returns {Boolean}\n */\nfunction defaultTrue(val) {\n  return typeof val === 'undefined' ? true : val\n}\n\n/**\n * parse attrs from object\n *\n * @param {Object} obj\n * @returns {Stirng}\n */\nfunction getAttr(obj) {\n  var attr = ''\n  for (var key in obj) {\n    if (key) {\n      attr += ' ' + key + '=\"' + obj[key] + '\"'\n    }\n  }\n  return attr\n}\n\n/**\n * @param {String} url\n * @returns {String}\n */\nfunction prepHTTP(url) {\n  if (url.substring(0, 4) !== 'http' && url.substring(0, 2) !== '//') {\n    return 'http://' + url\n  }\n  return url\n}\n\n/**\n * @param {String} url\n * @returns {String}\n */\nfunction removeHTTP(url) {\n  return url.replace(re.http, '')\n}\n\nvar tagsToReplace = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;'\n}\n\n/**\n * Replace tag if should be replace\n *\n * @param {String} tag\n * @returns {String}\n */\nfunction replaceTag(tag) {\n  return tagsToReplace[tag] || tag\n}\n\n/**\n * Make string safe by replacing html tag\n *\n * @param {String} str\n * @returns {String}\n */\nfunction safe_tags_replace(str) {\n  return str.replace(/[&<>]/g, replaceTag)\n}\n\n/**\n * return an instance of AutoLink\n *\n * @param {String} string\n * @param {Object} options\n * @returns {Object}\n */\nfunction autoLink(string, options) {\n  return new AutoLink(string, options).parse()\n}\n\nexport default autoLink\n"],"names":["const","re","AutoLink","string","options","safe","replace","replaceTag","attrs","linkAttr","imageAttr","this","sharedAttr","getAttr","defaultTrue","val","obj","attr","key","prepHTTP","url","substring","prototype","shouldReplaceImage","image","shouldRelaceEmail","email","shouldRelaceBr","br","result","formatIMGMatch","bind","formatURLMatch","formatEmailMatch","call","match","p1","trim","cloudmusic","embed","indexOf","kickstarter","test","vimeo","youtube","youku","text","removeHTTP","http","tagsToReplace","tag","parse"],"mappings":"oLAAAA,IAAMC,QACE,gBACD,oFACE,2BACA,oKACK,2DACC,0FACJ,8EACF,iJACA,sFAST,SAASC,EAASC,EAAQC,2BACnBD,OAASC,EAAQC,KAAyBF,EA8MpCG,QAAQ,SAAUC,GA9M4BJ,OACpDC,QAAUA,OACVI,MAAQ,QACRC,SAAW,QACXC,UAAY,GACbC,KAAKP,QAAQQ,kBACVJ,MAAQK,EAAQF,KAAKP,QAAQQ,aAEhCD,KAAKP,QAAQK,gBACVA,SAAWI,EAAQF,KAAKP,QAAQK,WAEnCE,KAAKP,QAAQM,iBACVA,UAAYG,EAAQF,KAAKP,QAAQM,YAoI1C,SAASI,EAAYC,eACG,IAARA,GAA6BA,EAS7C,SAASF,EAAQG,OACXC,EAAO,OACN,IAAIC,KAAOF,EACVE,OACM,IAAMA,EAAM,KAAOF,EAAIE,GAAO,YAGnCD,EAOT,SAASE,EAASC,SACY,SAAxBA,EAAIC,UAAU,EAAG,IAAyC,OAAxBD,EAAIC,UAAU,EAAG,GAC9C,UAAYD,EAEdA,EA5JTlB,EAASoB,uBACMpB,QAMN,eACDqB,EAAqBT,EAAYH,KAAKP,QAAQoB,OAC9CC,EAAoBX,EAAYH,KAAKP,QAAQsB,OAC7CC,EAAiBb,EAAYH,KAAKP,QAAQwB,IAE1CC,EAAS,YACRN,EAGMZ,KAAKR,OAAOG,QAAQL,EAAGmB,IAAKT,KAAKmB,eAAeC,KAAKpB,OAFrDA,KAAKR,OAAOG,QAAQL,EAAGmB,IAAKT,KAAKqB,eAAeD,KAAKpB,OAI5Dc,MACOd,KAAKsB,iBAAiBC,KAAKvB,KAAMkB,IAExCF,MACOE,EAAOvB,QAAQ,SAAU,WAE7BuB,kBAMO,SAASM,EAAOC,QACtBjB,EAASgB,EAAME,SACnB1B,KAAKP,QAAQkC,YAAc3B,KAAKP,QAAQmC,QACtCJ,EAAMK,QAAQ,6BAA+B,SACxCL,EAAM7B,QACXL,EAAGqC,WACHF,EACE,mLAIJzB,KAAKP,QAAQqC,aAAe9B,KAAKP,QAAQmC,QACvCtC,EAAGwC,YAAYC,KAAKP,UACfA,EAAM7B,QACXL,EAAGwC,YACHL,EACE,6GAIJzB,KAAKP,QAAQuC,OAAShC,KAAKP,QAAQmC,QACjCtC,EAAG0C,MAAMD,KAAKP,UACTA,EAAM7B,QACXL,EAAG0C,MACHP,EACE,mKAIJzB,KAAKP,QAAQwC,SAAWjC,KAAKP,QAAQmC,QACnCtC,EAAG2C,QAAQF,KAAKP,UACXA,EAAM7B,QACXL,EAAG2C,QACHR,EACE,yHAIJzB,KAAKP,QAAQyC,OAASlC,KAAKP,QAAQmC,QACjCtC,EAAG4C,MAAMH,KAAKP,UACTA,EAAM7B,QACXL,EAAG4C,MACHT,EACE,mHAIJU,EAAOnC,KAAKP,QAAQ2C,WAAwBZ,EAuFvC7B,QAAQL,EAAG+C,KAAM,IAvF+Bb,SAEvDC,EACA,YACAD,EACA,IACAxB,KAAKH,MACLG,KAAKF,SACL,IACAqC,EACA,uBAOY,SAASX,EAAOC,YACtBD,EAAME,OACFpC,EAAGuB,MAAMkB,KAAKP,GAGtBC,EACA,aACAjB,EAASgB,EAAME,QACf,IACA1B,KAAKH,MACLG,KAAKD,UACL,KAGGC,KAAKqB,eAAeG,EAAOC,qBAKlB,SAASU,UAClBA,EAAKxC,QACVL,EAAGyB,MACH,sBAAwBf,KAAKH,MAAQG,KAAKF,SAAW,aAmD3D,IAAIwC,OACG,YACA,WACA,QASP,SAAS1C,EAAW2C,UACXD,EAAcC,IAAQA,SAoB/B,SAAkB/C,EAAQC,UACjB,IAAIF,EAASC,EAAQC,GAAS+C"}